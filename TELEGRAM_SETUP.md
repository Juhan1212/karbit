# í…”ë ˆê·¸ë¨ ë´‡ ì„¤ì • ê°€ì´ë“œ

## ê°œìš”

Karbitì€ ë‹¨ì¼ í…”ë ˆê·¸ë¨ ë´‡ì„ í†µí•´ ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ê°œë³„í™”ëœ ì•Œë¦¼ì„ ì œê³µí•©ë‹ˆë‹¤. ê° ì‚¬ìš©ìëŠ” ê³ ìœ í•œ `chat_id`ë¥¼ í†µí•´ ìì‹ ì˜ íŠ¸ë ˆì´ë”© ì•Œë¦¼ë§Œ ë°›ê²Œ ë©ë‹ˆë‹¤.

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì‚¬ìš©ì A   â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Karbit Bot  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”‚   ì‚¬ìš©ì B   â”‚
â”‚  (chat_id_A) â”‚        â”‚   (ë‹¨ì¼ ë´‡)   â”‚        â”‚  (chat_id_B) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Database â”‚
                        â”‚  users   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë™ì‘ ë°©ì‹

1. **ì‚¬ìš©ìê°€ "í…”ë ˆê·¸ë¨ ì—°ë™" ë²„íŠ¼ í´ë¦­**
   - ì„œë²„ì—ì„œ ì¼íšŒìš© ì¸ì¦ í† í° ìƒì„± (10ë¶„ ìœ íš¨)
   - í…”ë ˆê·¸ë¨ ë”¥ë§í¬ ìƒì„±: `https://t.me/KarbitBot?start={TOKEN}`

2. **ì‚¬ìš©ìê°€ ë”¥ë§í¬ í´ë¦­**
   - í…”ë ˆê·¸ë¨ ì•±ì´ ìë™ìœ¼ë¡œ ì—´ë¦¼
   - `/start {TOKEN}` ëª…ë ¹ì–´ ìë™ ì „ì†¡

3. **ë´‡ì´ í† í° ê²€ì¦ ë° ì—°ë™**
   - ì¸ì¦ í† í° ìœ íš¨ì„± í™•ì¸
   - ì‚¬ìš©ìì˜ `chat_id` íšë“
   - DBì— `chat_id` ì €ì¥
   - í™˜ì˜ ë©”ì‹œì§€ ì „ì†¡

4. **ì•Œë¦¼ ì „ì†¡**
   - ì£¼ë¬¸ ë°œìƒ ì‹œ í•´ë‹¹ ì‚¬ìš©ìì˜ `chat_id`ë¡œ ë©”ì‹œì§€ ì „ì†¡
   - ê° ì‚¬ìš©ìëŠ” ìì‹ ì˜ ì•Œë¦¼ë§Œ ë°›ìŒ

## 1ë‹¨ê³„: BotFatherë¡œ ë´‡ ìƒì„±

### 1.1 BotFather ì‹œì‘

1. í…”ë ˆê·¸ë¨ì—ì„œ [@BotFather](https://t.me/BotFather) ê²€ìƒ‰
2. `/start` ëª…ë ¹ì–´ ì „ì†¡

### 1.2 ìƒˆ ë´‡ ìƒì„±

```
/newbot
```

- **ë´‡ ì´ë¦„**: Karbit Trading Bot
- **ë´‡ ì‚¬ìš©ìëª…**: KarbitTradingBot (ë˜ëŠ” ì‚¬ìš© ê°€ëŠ¥í•œ ë‹¤ë¥¸ ì´ë¦„)

### 1.3 ë´‡ í† í° ì €ì¥

BotFatherê°€ ì œê³µí•˜ëŠ” í† í°ì„ ì•ˆì „í•˜ê²Œ ì €ì¥:

```
8343048488:AAH7tP0ILe897MOCptIx0zZ49oiru5Kik9c
```

### 1.4 ë´‡ ì„¤ëª… ì„¤ì •

```
/setdescription
```

```
Karbit ìë™ë§¤ë§¤ í”Œë«í¼ì˜ ê³µì‹ ì•Œë¦¼ ë´‡ì…ë‹ˆë‹¤.
ì‹¤ì‹œê°„ íŠ¸ë ˆì´ë”© ì•Œë¦¼, ìˆ˜ìµ/ì†ì‹¤ ì•Œë¦¼, ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„ ì•Œë¦¼ì„ ë°›ì•„ë³´ì„¸ìš”.
```

### 1.5 ë´‡ ì •ë³´ ì„¤ì •

```
/setabouttext
```

```
Karbit ìë™ë§¤ë§¤ ì•Œë¦¼ ë´‡ ğŸš€
ì›¹ì‚¬ì´íŠ¸: https://karbit.com
```

### 1.6 ë´‡ í”„ë¡œí•„ ì‚¬ì§„ ì„¤ì • (ì„ íƒì‚¬í•­)

```
/setuserpic
```

## 2ë‹¨ê³„: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env` íŒŒì¼ì— ë‹¤ìŒì„ ì¶”ê°€:

```env
TELEGRAM_BOT_TOKEN=8343048488:AAH7tP0ILe897MOCptIx0zZ49oiru5Kik9c
TELEGRAM_BOT_USERNAME=KarbitTradingBot
TELEGRAM_WEBHOOK_URL=https://karbit.com/api/telegram/webhook
```

## 3ë‹¨ê³„: Webhook ì„¤ì •

### ê°œë°œ í™˜ê²½ (ngrok ì‚¬ìš©)

1. ngrok ì„¤ì¹˜ ë° ì‹¤í–‰:

```bash
ngrok http 3000
```

2. ngrok URL ë³µì‚¬ (ì˜ˆ: `https://abc123.ngrok.io`)

3. Webhook ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰:

```bash
curl -X POST "https://api.telegram.org/bot8343048488:AAH7tP0ILe897MOCptIx0zZ49oiru5Kik9c/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://15a50c707194.ngrok-free.app/api/telegram/webhook",
    "allowed_updates": ["message", "callback_query"]
  }'
```

### í”„ë¡œë•ì…˜ í™˜ê²½

1. ë„ë©”ì¸ SSL ì¸ì¦ì„œ í™•ì¸ (í•„ìˆ˜)

2. Webhook ì„¤ì •:

```bash
curl -X POST "https://api.telegram.org/bot8343048488:AAH7tP0ILe897MOCptIx0zZ49oiru5Kik9c/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://karbit.world/api/telegram/webhook",
    "allowed_updates": ["message", "callback_query"]
  }'
```

### Webhook í™•ì¸

```bash
curl "https://api.telegram.org/bot8343048488:AAH7tP0ILe897MOCptIx0zZ49oiru5Kik9c/getWebhookInfo"
```

ì‘ë‹µ ì˜ˆì‹œ:

```json
{
  "ok": true,
  "result": {
    "url": "https://karbit.com/api/telegram/webhook",
    "has_custom_certificate": false,
    "pending_update_count": 0,
    "last_error_date": 0,
    "last_error_message": "",
    "max_connections": 40,
    "allowed_updates": ["message", "callback_query"]
  }
}
```

## 4ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

```bash
npm run db:generate
npm run db:migrate
```

## 5ë‹¨ê³„: ì„œë²„ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸

### 5.1 ì„œë²„ ì‹¤í–‰

```bash
npm run dev
```

### 5.2 ì›¹ì—ì„œ ì—°ë™ í…ŒìŠ¤íŠ¸

1. Karbit ì›¹ì‚¬ì´íŠ¸ ë¡œê·¸ì¸
2. ëŒ€ì‹œë³´ë“œ ë˜ëŠ” ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™
3. "í…”ë ˆê·¸ë¨ ì—°ë™í•˜ê¸°" ë²„íŠ¼ í´ë¦­
4. í…”ë ˆê·¸ë¨ ì•±ì´ ìë™ìœ¼ë¡œ ì—´ë¦¼
5. `/start` ëª…ë ¹ì–´ ìë™ ì „ì†¡
6. "ì—°ë™ ì™„ë£Œ" ë©”ì‹œì§€ í™•ì¸

### 5.3 ë´‡ ëª…ë ¹ì–´ í…ŒìŠ¤íŠ¸

í…”ë ˆê·¸ë¨ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ í…ŒìŠ¤íŠ¸:

- `/status` - ê³„ì • ìƒíƒœ í™•ì¸
- `/settings` - ì•Œë¦¼ ì„¤ì •
- `/help` - ë„ì›€ë§

## 6ë‹¨ê³„: ì•Œë¦¼ ì „ì†¡ ì˜ˆì‹œ

### ì£¼ë¬¸ ì²´ê²° ì•Œë¦¼

```typescript
import {
  sendTelegramMessage,
  formatOrderNotification,
} from "~/services/telegram";

// ì‚¬ìš©ìì˜ chat_id ì¡°íšŒ
const user = await db.query.users.findFirst({
  where: eq(users.id, userId),
});

if (user?.telegramChatId && user.telegramNotificationsEnabled) {
  const order = {
    symbol: "BTC/USDT",
    type: "BUY" as const,
    price: 45000,
    amount: 0.1,
    exchange: "Binance",
    timestamp: new Date(),
  };

  const message = formatOrderNotification(order);
  await sendTelegramMessage(user.telegramChatId, message);
}
```

### ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„ ì•Œë¦¼

```typescript
import { sendTelegramMessage, formatPremiumAlert } from "~/services/telegram";

const user = await db.query.users.findFirst({
  where: eq(users.id, userId),
});

if (user?.telegramChatId && user.telegramNotificationsEnabled) {
  const message = formatPremiumAlert(
    "BTC/USDT",
    60000000, // â‚©60,000,000
    45000, // $45,000
    5.5 // 5.5% í”„ë¦¬ë¯¸ì—„
  );

  await sendTelegramMessage(user.telegramChatId, message);
}
```

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ì¸ì¦ í† í°

- 10ë¶„ ìœ íš¨ ê¸°ê°„
- ì¼íšŒìš© (í•œ ë²ˆ ì‚¬ìš© í›„ ë¬´íš¨í™”)
- ì•”í˜¸í™”ëœ ëœë¤ 64ì ë¬¸ìì—´

### 2. Webhook ë³´ì•ˆ

- HTTPS í•„ìˆ˜
- ì„œë²„ ì¸¡ í† í° ê²€ì¦
- Rate Limiting ì ìš© ê¶Œì¥

### 3. ê°œì¸ì •ë³´ ë³´í˜¸

- `chat_id`ëŠ” ë¯¼ê° ì •ë³´ë¡œ ì·¨ê¸‰
- DBì— ì•”í˜¸í™” ì €ì¥ ê¶Œì¥
- ì—°ë™ í•´ì œ ì‹œ ì¦‰ì‹œ ì‚­ì œ

## ë¬¸ì œ í•´ê²°

### Webhookì´ ì‘ë™í•˜ì§€ ì•ŠìŒ

```bash
# Webhook ì‚­ì œ
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/deleteWebhook"

# Webhook ì¬ì„¤ì •
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://your-domain.com/api/telegram/webhook"}'
```

### ë´‡ì´ ì‘ë‹µí•˜ì§€ ì•ŠìŒ

1. ë´‡ í† í° í™•ì¸
2. Webhook URL í™•ì¸
3. ì„œë²„ ë¡œê·¸ í™•ì¸
4. í…”ë ˆê·¸ë¨ ì„œë²„ ìƒíƒœ í™•ì¸

### ë©”ì‹œì§€ê°€ ì „ì†¡ë˜ì§€ ì•ŠìŒ

1. `chat_id` í™•ì¸
2. ì‚¬ìš©ìê°€ ë´‡ì„ ì°¨ë‹¨í–ˆëŠ”ì§€ í™•ì¸
3. í…”ë ˆê·¸ë¨ API ì‘ë‹µ ë¡œê·¸ í™•ì¸

## ì°¸ê³  ìë£Œ

- [Telegram Bot API ê³µì‹ ë¬¸ì„œ](https://core.telegram.org/bots/api)
- [BotFather ê°€ì´ë“œ](https://core.telegram.org/bots#6-botfather)
- [Webhook ê°€ì´ë“œ](https://core.telegram.org/bots/webhooks)

---

**Built with â¤ï¸ by Karbit Team**
